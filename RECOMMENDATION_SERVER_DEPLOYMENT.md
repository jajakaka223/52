# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Telegram Recommendation Server

## –û–ø–∏—Å–∞–Ω–∏–µ
HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ Python, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º Telegram –±–æ—Ç–æ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–µ. –í–∫–ª—é—á–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram –∏ email —Å –∑–∞–ø—Ä–æ—Å–æ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

## –§–∞–π–ª—ã
- `telegram_recommendation_server.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ Flask
- `recommendation_requirements.txt` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
- `start_recommendation_server.sh` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 109.205.58.89

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp telegram_recommendation_server.py root@109.205.58.89:/root/
scp recommendation_requirements.txt root@109.205.58.89:/root/
scp start_recommendation_server.sh root@109.205.58.89:/root/
```

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
```bash
ssh root@109.205.58.89
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd /root
pip3 install -r recommendation_requirements.txt
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x start_recommendation_server.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
./start_recommendation_server.sh
```

### 5. –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å–∫ —Å nohup –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ–Ω–µ
nohup python3 telegram_recommendation_server.py > recommendation_server.log 2>&1 &

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
ps aux | grep telegram_recommendation_server
tail -f recommendation_server.log
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Railway –ø—Ä–æ–µ–∫—Ç–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–æ–±–∞–≤—å—Ç–µ –≤ Railway –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
```
PYTHON_BOT_SERVER=http://109.205.58.89:8000
```

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### POST /send-telegram-message
–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "chat_id": "-1002419921277",
  "message_thread_id": "12493",
  "text": "‚úÖ –ó–ê–Ø–í–ö–ê –í–´–ü–û–õ–ù–ï–ù–ê\n\nüìß Email –∫–ª–∏–µ–Ω—Ç–∞: client@example.com\nüõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç: –ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
  "parse_mode": "Markdown"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "messageId": 12345,
  "timestamp": "2025-01-14T10:30:00"
}
```

### POST /send-recommendation-email
–û—Ç–ø—Ä–∞–≤–∫–∞ email —Å –∑–∞–ø—Ä–æ—Å–æ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "email_address": "client@example.com",
  "route_info": "–ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Email —Å –∑–∞–ø—Ä–æ—Å–æ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω",
  "timestamp": "2025-01-14T10:30:00"
}
```

### POST /send-complete-notification
–ü–æ–ª–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Telegram + Email)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "chat_id": "-1002419921277",
  "message_thread_id": "12493",
  "text": "‚úÖ –ó–ê–Ø–í–ö–ê –í–´–ü–û–õ–ù–ï–ù–ê\n\nüìß Email –∫–ª–∏–µ–Ω—Ç–∞: client@example.com\nüõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç: –ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\n\nüìß –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É",
  "email_address": "client@example.com",
  "route_info": "–ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
  "parse_mode": "Markdown"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "results": {
    "telegram": {
      "success": true,
      "messageId": 12345
    },
    "email": {
      "success": true
    }
  },
  "timestamp": "2025-01-14T10:30:00"
}
```

### GET /health
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "timestamp": "2025-01-14T10:30:00",
  "telegram_bot_configured": true,
  "email_configured": true,
  "service": "Telegram Recommendation Server"
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Railway –ø—Ä–æ–µ–∫—Ç–æ–º

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ utils/telegram_notifier.js
Railway –ø—Ä–æ–µ–∫—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ –∞–¥—Ä–µ—Å—É `http://109.205.58.89:8000/send-telegram-message`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞
curl http://109.205.58.89:8000/health

# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
curl -X POST http://109.205.58.89:8000/send-telegram-message \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "-1002419921277",
    "message_thread_id": "12493",
    "text": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞"
  }'

# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ email —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π
curl -X POST http://109.205.58.89:8000/send-recommendation-email \
  -H "Content-Type: application/json" \
  -d '{
    "email_address": "test@example.com",
    "route_info": "–ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"
  }'
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞
```bash
curl http://109.205.58.89:8000/health
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
tail -f recommendation_server.log
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```bash
pkill -f telegram_recommendation_server.py
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö IP (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Flask)
2. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ API –∫–ª—é—á–∏

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü–æ—Ä—Ç 8000 –∑–∞–Ω—è—Ç
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å
lsof -i :8000
# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>
```

### –û—à–∏–±–∫–∏ Telegram API
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ —á–∞—Ç–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å chat_id –∏ message_thread_id

### –û—à–∏–±–∫–∏ Email
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Gmail SMTP
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å email –∞–¥—Ä–µ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
- –£—Å–ø–µ—à–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ Telegram API
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ email
- –í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª `recommendation_server.log`
